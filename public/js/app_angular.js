// Generated by CoffeeScript 1.8.0
(function() {
  var app;

  app = void 0;

  app = angular.module("EtudiantEPSIApp", ["ngResource", "ngRoute"]);

  app.config(function($routeProvider) {
    $routeProvider.when("/", {
      templateUrl: "partials/etudiantList.html",
      controller: "ListEtudiantCtrl"
    }).when("/user/:id_user", {
      templateUrl: "partials/etudiantView.html",
      controller: "EtudiantCtrl"
    }).when("/add/user", {
      templateUrl: "partials/etudiantCreate.html",
      controller: "EtudiantAddCtrl"
    }).when("/edit/user/:id_user", {
      templateUrl: "partials/etudiantCreate.html",
      controller: "EtudiantEditCtrl"
    }).otherwise({
      redirectTo: "/"
    });
  });

  app.controller("EtudiantCtrl", [
    "$scope", "Users", "$routeParams", function($scope, Users, $routeParams) {
      $scope.user = null;
      return $scope.user = Users.get({
        id: $routeParams.id_user
      });
    }
  ]);

  app.controller("EtudiantAddCtrl", [
    "$scope", "Users", "$window", "$location", function($scope, Users, $window, $location) {
      $scope.user = new Users();
      $scope.createUser = function(isValid) {
        $scope.user.$save(function(d) {
          $location.path("/");
        });
      };
      return $scope.back = function() {
        $window.history.back();
      };
    }
  ]);

  app.controller("ListEtudiantCtrl", [
    "$scope", "Users", "$window", "$location", function($scope, Users, $window, $location) {
      $scope.listeUsers = [];
      $scope.listeUsers = Users.query();
      $scope.openUser = function(id) {
        $location.path("user/" + id);
      };
      $scope.createUser = function() {
        $location.path("/add/user");
      };
      $scope.removeUser = function(id) {
        if ($window.confirm("Vous Ãªtes sur ?")) {
          return Users["delete"]({
            id: id
          }, function(d) {
            return $scope.listeUsers = d;
          });
        }
      };
      return $scope.editUser = function(id) {
        $location.path("/edit/user/" + id);
      };
    }
  ]);

  app.controller("EtudiantEditCtrl", [
    "$scope", "Users", "$routeParams", "$location", "$window", function($scope, Users, $routeParams, $location, $window) {
      $scope.user = null;
      $scope.user = Users.get({
        id: $routeParams.id_user
      });
      $scope.createUser = function(isValid) {
        $scope.user.$update({
          id: $scope.user.id
        }, function(d) {
          $location.path("user/" + $scope.user.id);
        });
      };
      return $scope.back = function() {
        $window.history.back();
      };
    }
  ]);

  app.factory("Users", [
    "$resource", "$location", function($resource, $location) {
      return $resource($location.protocol() + "://" + $location.host() + ":" + $location.port() + "/api/users/:id", {}, {
        update: {
          method: "PUT",
          isArray: false
        },
        "delete": {
          method: "DELETE",
          isArray: true
        }
      });
    }
  ]);

}).call(this);
